@require "Themes/Regular/GeometricVariations/Button-RegularTheme-RegularGeometry.styl"
@require "Themes/Regular/GeometricVariations/Button-RegularTheme-SmallGeometry.styl"
@require "Themes/Regular/GeometricVariations/Button-RegularTheme-LinkLikeGeometry.styl"

@require "Themes/Regular/DecorativeVariations/Button-RegularTheme-RegularDecoration.styl"
@require "Themes/Regular/DecorativeVariations/Button-RegularTheme-AccentedDecoration.styl"
@require "Themes/Regular/DecorativeVariations/Button-RegularTheme-LinkLikeDecoration.styl"


Button--YDF = {

  defaultProperties: {

    themes: {
      regular: {

        componentIndependentCSS_Class: "RegularTheme--YDF",

        geometricVariations: {
          regular: Button-RegularTheme-RegularGeometry--YDF,
          small: Button-RegularTheme-SmallGeometry--YDF,
          linkLike: Button-RegularTheme-LinkLikeGeometry--YDF
        },

        decorativeVariations: {
          regular: Button-RegularTheme-RegularDecoration--YDF,
          accented: Button-RegularTheme-AccentedDecoration--YDF,
          linkLike: Button-RegularTheme-LinkLikeDecoration--YDF
        }

      }
    }

  },

  defaultOptions: {
    themeIndependentStylesOnly: false,
    areThemesCSS_ClassesCommon: false,
    loadingPlaceholder: true,
    themeIndependentGeometricVariations: true,
    geometricModifiers: {
      pillShape: true,
      squareShape: true,
      singleLine: true,
      noLeftBorderAndRoundings: true,
      noRightBorderAndRoundings: true
    },
    decorativeModifiers: {
      bordersDisguising: true,
      noBackground: true
    }
  }

}


provideButtonYDF_Component(
  preset = Button--YDF.defaultProperties,
  overridings = {},
  options = Button--YDF.defaultOptions,
  restParameters__MUST_NOT_BE...
)

  properties = deeplyCloneAndOverrideObject(preset, overridings)

  validateObjectTypeParameter({
    mixinOrFunctionName: "provideButtonYDF_Component",
    targetParameterNumber: 3,
    targetParameter: options,
    schema: {
      themeIndependentStylesOnly: {
        type: DataTypes.boolean,
        defaultValue: Button--YDF.defaultOptions.themeIndependentStylesOnly
      },
      areThemesCSS_ClassesCommon: {
        type: DataTypes.boolean,
        defaultValue: Button--YDF.defaultOptions.externalThemes
      },
      loadingPlaceholder: {
        type: DataTypes.boolean,
        defaultValue: Button--YDF.defaultOptions.loadingPlaceholder
      },
      themeIndependentGeometricVariations: {
        type: DataTypes.boolean,
        defaultValue: Button--YDF.defaultOptions.themeIndependentGeometricVariations
      },
      geometricModifiers: {
        type: DataTypes.object,
        properties: {
          pillShape: {
            type: DataTypes.boolean,
            defaultValue: Button--YDF.defaultOptions.geometricModifiers.pillShape
          },
          squareShape: {
            type: DataTypes.boolean,
            defaultValue: Button--YDF.defaultOptions.geometricModifiers.squareShape
          },
          singleLine: {
            type: DataTypes.boolean,
            defaultValue: Button--YDF.defaultOptions.geometricModifiers.singleLine
          },
          noLeftBorderAndRoundings: {
            type: DataTypes.boolean,
            defaultValue: Button--YDF.defaultOptions.geometricModifiers.noLeftBorderAndRoundings
          },
          noRightBorderAndRoundings: {
            type: DataTypes.boolean,
            defaultValue: Button--YDF.defaultOptions.geometricModifiers.noRightBorderAndRoundings
          }
        },
        defaultValue: Button--YDF.defaultOptions.geometricModifiers
      },
      decorativeModifiers: {
        type: DataTypes.object,
        properties: {
          bordersDisguising: {
            type: DataTypes.boolean,
            defaultValue: Button--YDF.defaultOptions.decorativeModifiers.bordersDisguising
          },
          noBackground: {
            type: DataTypes.boolean,
            defaultValue: Button--YDF.defaultOptions.decorativeModifiers.noBackground
          }
        },
        defaultValue: Button--YDF.defaultOptions.decorativeModifiers
      }
    },
    followingParametersWhichMustNotBe: restParameters__MUST_NOT_BE
  })


  // ━━━ Methods ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
  applyBasicRules()

    .Button--YDF

      ButtonLikeElementsPrimer()

      cursor pointer


      &:disabled

        cursor not-allowed


    button.Button--YDF,
    a.Button--YDF

      display inline-flex
      justify-content center
      align-items center


    if !options.geometricModifiers.singleLine

      input

        word-break break-all


    a

      &.Button--YDF__DisabledState

        pointer-events none


    .Button--YDF-Label

      /a &

        text-align center


      if !options.geometricModifiers.singleLine

        word-break break-all


    input

      white-space normal


    .Button--YDF-SVG_Icon

      flex-shrink 0


    if options.loadingPlaceholder

      .Button--YDF__LoadingPlaceholder

        display inline-block


  // ─── Geometry ──────────────────────────────────────────────────────────────────────────────────────────────────────
  applyGeometricVariation(themeName, variationName, variation)

    VARIATION_FULLY_QUALIFIED_NAME_FOR_LOGGING = buildString(
      "Button.${ themeName }Theme.${ variationName }Geometry",
      { themeName: themeName, variationName: variationName }
    )

    CONTEXT_SELECTOR = selector() == "&" ? null : selector()

    cachedValidReusables = extractAndValidateObjectProperties({
      targetObject: variation,
      targetObjectName: VARIATION_FULLY_QUALIFIED_NAME_FOR_LOGGING,
      extracts: {
        textSize: {
          dotSeparatedPath: "label.text.size",
          required: true
        },
        lineSpacing: {
          dotSeparatedPath: "label.text.lineSpacing",
          mustBeInsteadOf: "label.text.lineHeight"
        },
        lineHeight: {
          dotSeparatedPath: "label.text.lineHeight",
          required: false
        },
        topSpacing: {
          dotSeparatedPath: "label.spacing.top",
          required: false,
          incompatibleWith: "label.spacing.verticalSymmetric"
        },
        bottomSpacing: {
          dotSeparatedPath: "label.spacing.bottom",
          required: false,
          incompatibleWith: "label.spacing.verticalSymmetric"
        },
        verticalSymmerticSpacingAsTopSpacing: {
          newName: "topSpacing",
          dotSeparatedPath: "label.spacing.verticalSymmetric",
          required: false
        },
        verticalSymmerticSpacingAsBottomSpacing: {
          newName: "bottomSpacing",
          dotSeparatedPath: "label.spacing.verticalSymmetric",
          required: false
        },
        labelUpwardShifting: {
          dotSeparatedPath: "label.spacing.upwardShifting",
          required: false
        },
        leftSpacingWhenLabelGoingFirst: {
          dotSeparatedPath: "label.spacing.leftWhenGoingFirst",
          required: true
        },
        rightSpacingWhenLabelGoingLast: {
          dotSeparatedPath: "label.spacing.rightWhenGoingLast",
          required: false
        },
        bordersSizing: {
          dotSeparatedPath: "rootElement.borders",
          required: false
        }
      }
    })

    HEIGHT = computeTotalHeightByTextElementHeightSizingSpecification({
      type: TextElementHeightSizingTypes--YDF.natural,
      borders: cachedValidReusables.bordersSizing,
      paddings: {
        top: cachedValidReusables.topSpacing,
        bottom: cachedValidReusables.bottomSpacing,
      },
      fontSize: cachedValidReusables.textSize,
      lineHeight: 1
    })

    +provideDefaultSelectorWhenRootAndApply(".Button--YDF")

      validateAndAssignStoredInObjectCSS_Properties({
        targetObject: variation,
        targetObjectName: VARIATION_FULLY_QUALIFIED_NAME_FOR_LOGGING,
        assigments: {
          min-width: { dotSeparatedPath: "rootElement.minimalWidth", required: false }
        }
      })

      BordersSizing(cachedValidReusables.bordersSizing)

      applyMixinStoredInObjectIfItIsNotNull(variation.rootElement.customDeclarations)


    /input{getCurrentSelectorSubstitutingRoot(".Button--YDF")}

      // [ Approach ] The vertical padding will be defined by `TextElementHeightSizing`, herewith it will be
      //    the corrected value respecting the extra space caused the line height
      Paddings({
        horizontalSymmetric: cachedValidReusables.horizontalSymmetricSpacingOfLoneLabel,
        left: cachedValidReusables.leftSpacingWhenLabelGoingFirst,
        right: cachedValidReusables.rightSpacingWhenLabelGoingLast
      })

      // [ Approach ] For both single line and multi line modes the settings will be same because the text overflow
      //   already has been set in the common declarations.
      TextElementHeightSizing({
        type: TextElementHeightSizingTypes--YDF.natural,
        fontSize: cachedValidReusables.textSize,
        lineHeight: cachedValidReusables.lineHeight,
        lineSpacing: cachedValidReusables.lineSpacing,
        borders: cachedValidReusables.bordersSizing,
        mustSkipBordersApplying: true,
        paddings: {
          top: cachedValidReusables.topSpacing,
          bottom: cachedValidReusables.topSpacing,
          upwardShifting: cachedValidReusables.labelUpwardShifting
        },
        mustReduceVerticalPaddingsByExtraSpaceCausedByLineHeight: true
      })

    if options.geometricModifiers.pillShape

      &.Button--YDF__PillShapeGeometricModifier

        TEXT_SIZE_TO_BORDER_RADIUS_RATIO = extractAndValidateObjectProperties({
          targetObject: variation,
          targetObjectName: VARIATION_FULLY_QUALIFIED_NAME_FOR_LOGGING,
          extracts: {
            textSizeToBorderRadiusRatio: {
              dotSeparatedPath: "rootElement.modifiers.pillShape.textSizeToBorderRadiusRatio", required: true
            }
          }
        }).textSizeToBorderRadiusRatio

        border-radius cachedValidReusables.textSize * TEXT_SIZE_TO_BORDER_RADIUS_RATIO


    if options.geometricModifiers.squareShape

      &.Button--YDF__SquareShapeGeometricModifier

        min-width HEIGHT
        max-width HEIGHT
        height HEIGHT


    .Button--YDF-Label

      Paddings({
        top: cachedValidReusables.topSpacing,
        bottom: cachedValidReusables.topSpacing,
        upwardShifting: cachedValidReusables.labelUpwardShifting
      })


      MultilineValueLabelStyles()

        applyTextGeometryWithoutExtraSpaceCausedByLineHeight({
          fontSize: cachedValidReusables.textSize,
          lineSpacing: cachedValidReusables.lineSpacing,
          lineHeight: cachedValidReusables.lineHeight,
          mustApplyNegativeMarginsToRootElement: true,
          mustAllowWordsBreakingAnywhere: !options.geometricModifiers.singleLine
        })

      if !options.geometricModifiers.singleLine

        MultilineValueLabelStyles()


      applyMixinStoredInObjectIfItIsNotNull(variation.label.customDeclarations)


      &:first-child:last-child

        validateAndAssignStoredInObjectCSS_Properties({
          targetObject: variation,
          targetObjectName: VARIATION_FULLY_QUALIFIED_NAME_FOR_LOGGING,
          assigments: {
            margin-left: { dotSeparatedPath: "label.spacing.horizontalSymmetricWhenLone", required: true }
          }
        })


      &:first-child:not(:last-child)

        margin-left: cachedValidReusables.leftSpacingWhenLabelGoingFirst


      &:not(first-child):last-child

        margin-right: cachedValidReusables.rightSpacingWhenLabelGoingLast


      if options.geometricModifiers.singleLine

        /{CONTEXT_SELECTOR}.Button--YDF__SingleLineGeometricModifier .Button--YDF-Label

          font-size: cachedValidReusables.textSize


        /{CONTEXT_SELECTOR}:not(.Button--YDF__SingleLineGeometricModifier) .Button--YDF-Label

          MultilineValueLabelStyles()


    .Button--YDF-SVG_Icon

      iconHeight = extractAndValidateObjectProperties({
        targetObject: variation,
        targetObjectName: VARIATION_FULLY_QUALIFIED_NAME_FOR_LOGGING,
        extracts: {
          iconHeight: {
            dotSeparatedPath: "SVG_Icon.default.height",
            required: true
          }
        }
      }).iconHeight

      validateAndAssignStoredInObjectCSS_Properties({
        targetObject: variation,
        targetObjectName: VARIATION_FULLY_QUALIFIED_NAME_FOR_LOGGING,
        assigments: {
          width: {
            dotSeparatedPath: "SVG_Icon.default.width",
            required: false
          }
        }
      })

      height: iconHeight


      if isNotNull(variation.SVG_Icon.default.spacing.leftWhenGoingFirst)

        &:first-child:not(:last-child)

          margin-left: variation.SVG_Icon.default.spacing.leftWhenGoingFirst


      if isNotNull(variation.SVG_Icon.default.spacing.rightWhenGoingLast)

        &:last-child:not(:first-child)

          margin-right: variation.SVG_Icon.default.spacing.rightWhenGoingLast


      &:first-child:last-child

        /* [ Initial equation ] labelFontSize + labelTopSpacing = iconHeight + iconTopSpacing
         * [ Formula ] iconPopMargin = labelFontSize + labelTopSpacing - iconHeight
         * The `labelUpwardShifting` could be eliminated because it presents in bots sides of initial equation. */
        topMargin = buildCalcExpressionFromFragments({
          textSize: cachedValidReusables.textSize,
          basicTopSpacing: @() {
            if (isNotNull(cachedValidReusables.topSpacing)) {
              return " + " + cachedValidReusables.topSpacing
            }
          },
          iconHeight: @() { return " - " + iconHeight }
        })

        bottomMargin = buildCalcExpressionFromFragments({
          textSize: cachedValidReusables.textSize,
          basicBottomSpacing: @() {
            if (isNotNull(cachedValidReusables.bottomSpacing)) {
              return " + " + cachedValidReusables.bottomSpacing
            }
          },
          iconHeight: @() { return " - " + iconHeight }
        })


        validateAndAssignStoredInObjectCSS_Properties({
          targetObject: variation,
          targetObjectName: VARIATION_FULLY_QUALIFIED_NAME_FOR_LOGGING,
          assigments: {
            margin-left: {
              dotSeparatedPath: "SVG_Icon.default.spacing.horizontalSymmetricWhenLone",
              required: false
            },
            margin-right: {
              dotSeparatedPath: "SVG_Icon.default.spacing.horizontalSymmetricWhenLone",
              required: false
            }
          }
        })

        margin-top: topMargin
        margin-bottom: bottomMargin

        if isNotNull(variation.SVG_Icon.default.spacing.horizontalSymmetricWhenLone)

          margin-left: variation.SVG_Icon.default.spacing.horizontalSymmetricWhenLone
          margin-right: variation.SVG_Icon.default.spacing.horizontalSymmetricWhenLone


      /

        PositionalRelationship({
          definitions: (
            ".Button--YDF-Label" {
              retireFromIt: { x: variation.SVG_Icon.default.spacing.afterLabel },
              pushItFromSelf: { x: variation.SVG_Icon.default.spacing.beforeLabel }
            }
          ),
          contextSelector: CONTEXT_SELECTOR,
          referenceElementSelector: ".Button--YDF-SVG_Icon"
        })


      applyMixinStoredInObjectIfItIsNotNull(variation.SVG_Icon.customDeclarations)


      specialIcons = substituteNull(variation.SVG_Icon.specials, {})

      for iconSpecificCSS_Class, dimensions in specialIcons

        &.{iconSpecificCSS_Class}

          // TODO Как и выше, но сначала разберись с неточностями в размерах
          validateAndAssignStoredInObjectCSS_Properties({
            targetObject: dimensions,
            targetObjectName: VARIATION_FULLY_QUALIFIED_NAME_FOR_LOGGING + ".variation.SVG_Icon.specials." + iconSpecificCSS_Class ,
            assigments: {
              width: {
                dotSeparatedPath: "width",
                required: false
              },
              height: {
                dotSeparatedPath: "height",
                requiredIf: {
                  predicate: @(variation) { return isNull(getObjectValueByDotSeparatedPathSafely(dimensions, "width")) },
                  conditionDescription: "'width' is null"
                }
              }
            }
          })


  applyThemeIndependentGeometricModifiers()

    if options.geometricModifiers.noLeftBorderAndRoundings

      .Button--YDF__NoLeftBorderAndRoundingsGeometricModifier

        border-left none
        BorderLeftFilletsRadius(0)


    if options.geometricModifiers.noRightBorderAndRoundings

      .Button--YDF__NoRightBorderAndRoundingsGeometricModifier

        border-right none
        BorderRightFilletsRadius(0)


    if options.geometricModifiers.squareShape

      input.Button--YDF__SquareShapeGeometricModifier

        SingleLineTextElementOverflowSafety({ displayEllipsis: false })
        padding 0


      .Button--YDF__SquareShapeGeometricModifier .Button--YDF-Label

        SingleLineTextElementOverflowSafety({ displayEllipsis: false })


    if options.geometricModifiers.singleLine

      input

        &.Button--YDF__SingleLineGeometricModifier

          SingleLineTextElementOverflowSafety({ displayEllipsis: true })


        &:not(.Button--YDF__SingleLineGeometricModifier)

          word-break break-all


      .Button--YDF-Label

        /.Button--YDF__SingleLineGeometricModifier &

          SingleLineTextElementOverflowSafety({ displayEllipsis: true })


        /:not(.Button--YDF__SingleLineGeometricModifier) &

          word-break break-all


  // ─── Decoration ───────────────────────────────────────────────────────────────────────────────────────────────────
  applyDecorativeVariation(themeName, variationName, variation)

    VARIATION_FULLY_QUALIFIED_NAME_FOR_LOGGING = buildString(
      "Button.${ themeName }Theme.${ variationName }Decoration",
      {
        themeName: themeName,
        variationName: variationName
      }
    )


    +provideDefaultSelectorWhenRootAndApply(".Button--YDF")

      validateAndAssignStoredInObjectCSS_Properties({
        targetObject: variation,
        targetObjectName: VARIATION_FULLY_QUALIFIED_NAME_FOR_LOGGING,
        assigments: {
          color: { dotSeparatedPath: "rootElement.text.color", required: false },
          underline: {
            dotSeparatedPath: "rootElement.text.underline",
            required: false,
            applier: applyObjectTypeUnderlineDefinition
          },
          background-color: { dotSeparatedPath: "rootElement.background.color", required: false },
          background-image: { dotSeparatedPath: "rootElement.background.image", required: false },
          border-style: { dotSeparatedPath: "rootElement.borders.style", required: false },
          border-color: { dotSeparatedPath: "rootElement.borders.color", required: false },
          outline: {
            dotSeparatedPath: "rootElement.outline",
            required: false,
            applier: applyOutlineObjectTypeDefinition
          },
          box-shadow: {
            dotSeparatedPath: "rootElement.shadow",
            required: false,
            applier: applyObjectTypeBoxShadowDefinition
          }
        }
      })

      applyMixinStoredInObjectIfItIsNotNull(variation.rootElement.customDeclarations)


    .Button--YDF-SVG_Icon

      validateAndAssignStoredInObjectCSS_Properties({
        targetObject: variation,
        targetObjectName: VARIATION_FULLY_QUALIFIED_NAME_FOR_LOGGING,
        assigments: {
          fill: { dotSeparatedPath: "SVG_Icon.color", required: true }
        }
      })

      applyMixinStoredInObjectIfItIsNotNull(variation.rootElement.customDeclarations)


    stateDependentStyles = isNotNull(variation.stateDependent) ? variation.stateDependent : {}

    for state, element in stateDependentStyles

      applyRootElementStateDependentStyles()

        validateAndAssignStoredInObjectCSS_Properties({
          targetObject: variation,
          targetObjectName: VARIATION_FULLY_QUALIFIED_NAME_FOR_LOGGING,
          assigments: {
            color: { dotSeparatedPath: "stateDependent." + state + ".rootElement.text.color", required: false },
            underline: {
              dotSeparatedPath: "stateDependent." + state + ".rootElement.text.underline",
              required: false,
              applier: applyObjectTypeUnderlineDefinition
            },
            background-color: { dotSeparatedPath: "stateDependent." + state + ".rootElement.background.color", required: false },
            background-image: { dotSeparatedPath: "stateDependent." + state + ".rootElement.background.image", required: false },
            border-style: { dotSeparatedPath: "stateDependent." + state + ".rootElement.borders.style", required: false },
            border-color: { dotSeparatedPath: "stateDependent." + state + ".rootElement.borders.color", required: false },
            outline: {
              dotSeparatedPath: "rootElement." + state + ".outline",
              required: false,
              applier: applyOutlineObjectTypeDefinition
            },
            box-shadow: {
              dotSeparatedPath: "stateDependent." + state + ".rootElement.shadow",
              required: false,
              applier: applyObjectTypeBoxShadowDefinition
            }
          }
        })


        applySVG_IconStateDependentStyles()

          validateAndAssignStoredInObjectCSS_Properties({
            targetObject: variation,
            targetObjectName: VARIATION_FULLY_QUALIFIED_NAME_FOR_LOGGING,
            assigments: {
              fill: { dotSeparatedPath: "stateDependent." + state + ".SVG_Icon.color", required: false }
            }
          })


      if state == "hover" || state == "focus" || state == "active"

        &:{state}

          applyRootElementStateDependentStyles()


          .Button--YDF-SVG_Icon

            applySVG_IconStateDependentStyles()


      else if state == "disabled"

        /button{getCurrentSelectorSubstitutingRoot(".Button--YDF")}:disabled,
        /input{getCurrentSelectorSubstitutingRoot(".Button--YDF")}:disabled,
        /a{getCurrentSelectorSubstitutingRoot(".Button--YDF")}.Button--YDF__DisabledState

          applyRootElementStateDependentStyles()


        /button{getCurrentSelectorSubstitutingRoot(".Button--YDF")}:disabled,
        /a{getCurrentSelectorSubstitutingRoot(".Button--YDF")}.Button--YDF__DisabledState

          .Button--YDF-SVG_Icon

            applySVG_IconStateDependentStyles()


  applyThemeIndependentDecorativeModifiers()

    if options.decorativeModifiers.bordersDisguising

      .Button--YDF__BordersDisguisingDecorativeModifier

        border-color transparent


    if options.decorativeModifiers.noBackground

      .Button--YDF__NoBackgroundDecorativeModifier

        background none


  // ━━━ Applying ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
  applyBasicRules()

  if !options.themeIndependentStylesOnly

    applyComponentThemes({
      CSS_Namespace: "Button--YDF",
      themes: properties.themes,
      areThemesCSS_ClassesCommon: options.externalThemes,
      themeIndependentGeometricVariations: options.themeIndependentGeometricVariations,
      applyGeometricVariation: applyGeometricVariation,
      applyDecorativeVariation: applyDecorativeVariation
    })

  applyThemeIndependentGeometricModifiers()
  applyThemeIndependentDecorativeModifiers()
